# build  Elasticsearch/Logstash/Kibana
> https://www.elastic.co/guide/en/elasticsearch/reference/6.0/_basic_concepts.html

## Elasticsearch basic
> 是文档存储索引
> Elasticsearch 是搜索平台（搜索延迟-秒）

1. 集群
>集群是一个或多个节点（服务器）的集合，它们一起保存您的整个数据并提供跨所有节点的联合索引和搜索功能。
> 集群由唯一名称标识，默认情况下为“elasticsearch”。此名称很重要，因为只有将节点设置为按其名称加入集群时，该节点才能成为集群的一部分

> 确保您不要在不同的环境中重复使用相同的集群名称，否则您最终可能会导致节点加入错误的集群。
>> 例如，您可以将logging-dev、logging-stage和logging-prod 用于开发、登台和生产集群。

>请注意，拥有一个只有一个节点的集群是有效且完全可以的。此外，您还可能有多个独立的集群，每个集群都有自己唯一的集群名称

2. 节点
> 索引是具有某种相似特征的文档的集合 


3. 指数
> 索引是具有某种相似特征的文档的集合。
> 例如，您可以有一个客户数据索引、另一个产品目录索引和另一个订单数据索引。索引由名称（必须全部小写）标识，
> 该名称用于在对其中的文档执行索引、搜索、更新和删除操作时引用索引。

> 在单个集群中，您可以定义任意数量的索引。

4. 类型
> 在6.0.0之后版本弃用

> 一种类型曾经是索引的逻辑类别/分区，允许您在同一索引中存储不同类型的文档，例如，一种类型用于用户，另一种类型用于博客文章。
> 不再可能在索引中创建多个类型，并且在以后的版本中将删除整个类型的概念。


5. 文档
> 文档是可以被索引的基本信息单元。例如，您可以为单个客户创建一个文档，为单个产品创建另一个文档，以及为单个订单创建另一个文档。

> 在索引/类型中，您可以存储任意数量的文档。请注意，尽管文档物理上驻留在索引中，但文档实际上必须被索引/分配给索引内的类型。

6. 碎片与副本
> 索引可能会存储大量数据，这些数据可能超出单个节点的硬件限制。
> 例如，占用 1TB 磁盘空间的十亿文档的单个索引可能不适合单个节点的磁盘，或者可能太慢而无法单独处理来自单个节点的搜索请求

> 为了解决这个问题，Elasticsearch 提供了将您的索引细分为多个称为分片的片段的能力。
> 创建索引时，您可以简单地定义所需的分片数量。每个分片本身就是一个功能齐全且独立的“索引”，可以托管在集群中的任何节点上

7. 分片之所以重要，主要有两个原因
   * 它允许您水平拆分/缩放内容量
   * 它允许您跨分片（可能在多个节点上）分布和并行化操作，从而提高性能/吞吐量

> 分片的分布机制以及其文档如何聚合回搜索请求的机制完全由 Elasticsearch 管理，并且对您作为用户是透明的。

>在随时可能出现故障的网络/云环境中，非常有用且强烈建议使用故障转移机制，以防分片/节点因某种原因脱机或消失。
> 为此，Elasticsearch 允许您将索引分片的一个或多个副本制作成所谓的副本分片或简称副本。

8. 复制之所以重要，主要有两个原因：
    * 它在分片/节点失败的情况下提供高可用性。出于这个原因，重要的是要注意，副本分片永远不会与从中复制它的原始/主分片分配在同一节点上。
    * 它允许您扩展搜索量/吞吐量，因为搜索可以在所有副本上并行执行

9. 总结
> 总而言之，每个索引都可以拆分为多个分片。索引也可以复制零次（意味着没有副本）或多次。
> 复制后，每个索引将具有主分片（从中复制的原始分片）和副本分片（主分片的副本）。可以在创建索引时为每个索引定义分片和副本的数量。
> 创建索引后，您可以随时动态更改副本数，但不能事后更改分片数。

>默认情况下，Elasticsearch 中的每个索引都分配有 5 个主分片和 1 个副本，这意味着如果您的集群中至少有两个节点，
>您的索引将有 5 个主分片和另外 5 个副本分片（1 个完整副本），总共每个索引 10 个分片。

10. 注意事项
> 每个 Elasticsearch 分片都是一个 Lucene 索引。在单个 Lucene 索引中可以拥有的文档数量是最大的。
> 截至LUCENE-5843，限制为2,147,483,519(= Integer.MAX_VALUE - 128) 个文档。_cat/shards您可以使用API监控分片大小。


# Test 
elastic 运行情况
GET /_cat/health?v
* 绿色 - 一切都很好（集群功能齐全）
* 黄色 - 所有数据都可用，但尚未分配一些副本（集群功能齐全）
* 红色 - 某些数据由于某种原因不可用（集群部分功能）

集群中的节点列表
GET /_cat/nodes?v&pretty

获取所有索引
GET /_cat/indices?v

创建索引
PUT /customer?pretty
GET /_cat/indices?v


在索引中添加数据
(/{index}/_doc/{id}, /{index}/_doc, or /{index}/_create/{id})
> 例如
PUT /customer/doc/1?pretty
{
  "name": "Jack"
}





























































































